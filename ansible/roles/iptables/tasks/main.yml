---

- name: Install 'iptables'
  become: true
  apt:
    name: iptables

- name: Flush all firewall rules
  iptables:
    flush: true

- name: ACCEPT ESTABLISHED on INPUT
  iptables:
    chain: INPUT
    ctstate: ESTABLISHED
    jump: ACCEPT

- name: ALLOW SSH traffic
  iptables:
    chain: INPUT
    destination_port: '22'
    protocol: tcp
    jump: ACCEPT

- name: ALLOW HTTP traffic
  iptables:
    chain: INPUT
    destination_port: '80'
    protocol: tcp
    jump: ACCEPT

- name: ALLOW HTTPS traffic
  iptables:
    chain: INPUT
    destination_port: '443'
    protocol: tcp
    jump: ACCEPT

- name: DROP INPUT
  iptables:
    chain: INPUT
    jump: DROP

- name: Install 'iptables-persistent'
  apt:
    name: iptables-persistent
